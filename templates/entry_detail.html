{% load static %}
<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ entry.title }} – GroupMindHub Entry</title>
  <link id="siteFavicon" rel="icon" type="image/png" href="{% static 'img/favicon-light.png' %}" />
    <style>
  :root{
      --palette-1:#dadccf;
      --palette-2:#000000;
      --palette-3:#85c4c0;
      --palette-4:#fdfceb;
      --palette-5:#7ebfbd;
      --accent-rgb:133,196,192;
      --grain-pattern:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.055'/%3E%3C/svg%3E");

      --bg:var(--palette-4);
      --panel:var(--palette-1);
      --panel-soft:#d6dacc;
      --border:#c3c9bb;
      --text:var(--palette-2);
      --muted:#52625f;
      --accent:var(--palette-3);
      --accent-strong:#7ebfbd;
      --shadow:rgba(0,0,0,0.08);
    }

    [data-theme='dark']{
      --bg:#0f1a1d;
      --panel:#142327;
      --panel-soft:#1f3337;
      --border:#243f44;
      --text:#f4faf9;
      --muted:#9bb5b2;
      --accent:#7ebfbd;
      --accent-strong:#9bd7d4;
      --shadow:rgba(0,0,0,0.45);
      --grain-pattern:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.1' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.09'/%3E%3C/svg%3E");
    }

    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:13.2px/1.55 'Inter',-apple-system,'Segoe UI',sans-serif;background-image:var(--grain-pattern);background-size:180px 180px;background-attachment:fixed;background-blend-mode:overlay}
    body::before{content:'';position:fixed;inset:0;pointer-events:none;background-image:var(--grain-pattern);background-size:180px 180px;mix-blend-mode:overlay;opacity:0.32;z-index:-1;}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(135deg,rgba(var(--accent-rgb),0.85),rgba(126,191,189,0.8));backdrop-filter:blur(12px);border-bottom:1px solid var(--border);background-image:var(--grain-pattern);background-blend-mode:overlay}
[data-theme='dark'] header{background:linear-gradient(135deg,rgba(12,32,34,0.92),rgba(18,49,52,0.92));background-image:var(--grain-pattern);background-blend-mode:overlay;}
    .wrap{max-width:1400px;margin:0 auto;padding:18px 32px}
    .site-head{display:flex;align-items:center;justify-content:space-between;gap:24px}
    .brand{display:flex;align-items:center;gap:18px}
    .brand-logo{height:62px;width:auto;display:block}
    .brand-logo-dark{display:none}
    [data-theme='dark'] .brand-logo-light{display:none}
    [data-theme='dark'] .brand-logo-dark{display:block}
    .head-controls{display:flex;align-items:center;gap:18px}
    .head-links{display:flex;align-items:center;gap:10px}
    .user-panel{display:flex;align-items:center;gap:14px}
    .user-chip{display:flex;align-items:center;gap:10px;padding:6px 12px;border-radius:999px;background:rgba(var(--accent-rgb),0.16);border:1px solid rgba(var(--accent-rgb),0.35)}
    .user-avatar{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:var(--panel);border:1px solid var(--border);font-weight:600;letter-spacing:.02em;color:var(--accent)}
    .user-meta{display:flex;flex-direction:column;line-height:1.2}
    .user-name{font-size:13px;font-weight:600;color:var(--text)}
    .user-role{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
    .logout-form{margin:0}
    .logout-form button{background:transparent;border:none;font-size:12px;color:var(--muted);padding:0 0 0 8px;text-decoration:underline;cursor:pointer}
    .logout-form button:hover{color:var(--accent)}
    select,button,input,textarea{background:var(--panel-soft);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:7px 12px;font-family:inherit;font-size:14px}
    select:focus,input:focus,textarea:focus{outline:2px solid rgba(var(--accent-rgb),0.45)}
    button{cursor:pointer;transition:all .18s ease}
    button.primary{background:var(--accent);color:var(--bg);border-color:transparent;font-weight:600}
    button.primary:hover{background:var(--accent-strong)}
    button.ghost{background:transparent;border-color:var(--border);color:var(--muted)}
    button.ghost:hover{border-color:var(--accent);color:var(--accent)}
    .theme-toggle{display:inline-flex;align-items:center;gap:10px;background:var(--panel-soft);border:1px solid var(--border);color:var(--text);padding:6px 14px;border-radius:999px;font-size:12px;font-weight:500;letter-spacing:.05em;text-transform:uppercase;cursor:pointer;transition:all .2s ease}
    .theme-toggle:hover{border-color:var(--accent);box-shadow:0 6px 16px rgba(var(--accent-rgb),0.18)}
    .theme-toggle .toggle-track{position:relative;width:40px;height:20px;border-radius:999px;background:rgba(var(--accent-rgb),0.3);flex-shrink:0;transition:background .2s}
    .theme-toggle .toggle-thumb{position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:50%;background:var(--accent);transition:transform .2s,background .2s}
    .theme-toggle .toggle-label{font-weight:600}
    [data-theme='dark'] .theme-toggle{background:var(--panel-soft);color:var(--text)}
    [data-theme='dark'] .theme-toggle .toggle-track{background:rgba(255,255,255,0.25)}
    [data-theme='dark'] .theme-toggle .toggle-thumb{transform:translateX(18px);background:var(--accent-strong)}
    .project-banner{display:flex;justify-content:space-between;align-items:flex-start;gap:24px;padding:0 24px 24px}
    .project-banner h1{margin:0;font-size:26px;color:var(--text)}
    .project-banner p{margin:6px 0 0;color:var(--muted);max-width:760px;font-size:13px;line-height:1.55}
    .workspace-toolbar{display:flex;align-items:center;justify-content:space-between;padding:0 24px 18px;gap:16px}
    .workspace-toolbar .controls{display:flex;gap:8px;flex-wrap:wrap}
    .workspace-shell{display:flex;gap:0;border:1px solid var(--border);border-radius:18px;background:rgba(255,255,255,0.3);overflow:hidden;box-shadow:0 18px 36px var(--shadow);background-image:var(--grain-pattern);background-blend-mode:overlay}
    [data-theme='dark'] .workspace-shell{background:rgba(10,20,22,0.6)}
    .workspace-pane{display:flex;flex-direction:column;min-width:220px;flex:1 1 33%;background:var(--panel);background-image:var(--grain-pattern);background-blend-mode:overlay}
    .workspace-pane[data-pane='doc']{flex:1.2 1 0}
    .workspace-pane[data-pane='editor']{flex:1 1 0;max-width:460px}
    .workspace-pane .card{box-shadow:none;border-radius:0;border:0;border-right:1px solid var(--border);background:transparent;height:100%;display:flex;flex-direction:column}
    .workspace-pane[data-pane='editor'] .card{border-right:0;border-left:1px solid var(--border)}
    .workspace-pane[data-pane='candidates'] .card{border-right:0}
    .workspace-pane .card .bd{overflow:auto;flex:1 1 auto;padding:18px 20px}
    .workspace-pane .card .hd{position:sticky;top:0;background:var(--panel);z-index:2}
    .workspace-gutter{width:8px;cursor:col-resize;background:rgba(var(--accent-rgb),0.15);transition:background .2s ease}
    .workspace-gutter:focus{outline:2px solid rgba(var(--accent-rgb),0.6)}
    .workspace-gutter:hover{background:rgba(var(--accent-rgb),0.25)}
    .workspace-gutter[data-active='true']{background:rgba(var(--accent-rgb),0.45)}
    .workspace-pane-max[data-pane]{display:none!important}
    .workspace-shell[data-max='doc'] [data-pane='doc']{display:flex;flex:1 1 auto}
    .workspace-shell[data-max='doc'] [data-pane='candidates'],
    .workspace-shell[data-max='doc'] [data-pane='editor'],
    .workspace-shell[data-max='doc'] .workspace-gutter{display:none}
    .workspace-shell[data-max='doc'] .workspace-pane[data-pane='doc'],
    .workspace-shell[data-max='candidates'] .workspace-pane[data-pane='candidates'],
    .workspace-shell[data-max='editor'] .workspace-pane[data-pane='editor']{flex:1 1 100%;width:100%;max-width:none}
    .workspace-shell[data-max='candidates'] [data-pane='candidates']{display:flex;flex:1 1 auto}
    .workspace-shell[data-max='candidates'] [data-pane='doc'],
    .workspace-shell[data-max='candidates'] [data-pane='editor'],
    .workspace-shell[data-max='candidates'] .workspace-gutter{display:none}
    .workspace-shell[data-max='editor'] [data-pane='editor']{display:flex;flex:1 1 auto}
    .workspace-shell[data-max='editor'] [data-pane='doc'],
    .workspace-shell[data-max='editor'] [data-pane='candidates'],
    .workspace-shell[data-max='editor'] .workspace-gutter{display:none}
    .workspace-shell[data-max]{border-radius:0;border:0;}
    .workspace-shell[data-max] .workspace-pane{min-width:0;}
    .workspace-shell[data-max] .workspace-pane .card{height:100%;border-radius:0;margin:0;}
    .workspace-shell[data-max] .workspace-pane .card .bd{max-height:none;}
    .workspace-shell[data-max] .entry-scroll{max-height:none;padding-right:18px;}
    .workspace-shell[data-max='doc'] .entry-card .bd{padding:24px;}
    .workspace-shell[data-max='editor'] .composer-card .bd{padding:24px;}
    .pane-title{font-size:13px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .workspace-pane[data-pane='doc'] .card .bd{padding:18px 18px 24px;overflow:auto}
    .entry-scroll{max-height:calc(100vh - 280px);overflow:auto;padding-right:12px}
    .section-tree{display:flex;flex-direction:column}
    .section-row{display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
    .section-status-chip{display:inline-flex;align-items:center;gap:6px;font-size:11px;padding:3px 8px;border-radius:999px;background:rgba(var(--accent-rgb),0.18);color:var(--accent);border:1px solid rgba(var(--accent-rgb),0.35)}
    [data-theme='dark'] .section-status-chip{background:rgba(var(--accent-rgb),0.25);color:var(--text);border-color:rgba(255,255,255,0.25)}
    .candidate-pane{display:flex;flex-direction:column;height:100%}
    .candidate-pane .card{height:50%;min-height:260px}
    .candidate-pane .card + .card{border-top:1px solid var(--border)}
    .candidate-pane .card .bd{padding:18px 20px;overflow:auto}
    .candidate-list,.queue-list{display:flex;flex-direction:column;gap:12px}
    .candidate-card{background:rgba(255,255,255,0.55);border:1px solid rgba(var(--accent-rgb),0.25);border-radius:12px;padding:14px;display:flex;flex-direction:column;gap:12px;box-shadow:0 12px 24px rgba(0,0,0,0.08)}
    [data-theme='dark'] .candidate-card{background:rgba(22,38,40,0.85);border-color:rgba(255,255,255,0.12)}
    .candidate-card-focus{outline:2px solid rgba(var(--accent-rgb),0.8);box-shadow:0 0 0 4px rgba(var(--accent-rgb),0.18)}
    .candidate-head{display:flex;justify-content:space-between;gap:12px}
    .candidate-title{font-weight:600;font-size:14px;color:var(--text)}
    .candidate-meta{display:flex;flex-wrap:wrap;gap:8px;font-size:12px;color:var(--muted)}
    .candidate-actions{display:flex;flex-wrap:wrap;gap:8px}
    .candidate-actions button{padding:6px 10px;border-radius:8px;font-size:12px}
    .candidate-score{font-size:12px;color:var(--muted);display:flex;gap:8px;align-items:center}
    .candidate-timer{font-weight:600;color:var(--accent)}
    .candidate-badges{display:flex;gap:6px;flex-wrap:wrap;font-size:11px}
    .badge{padding:2px 6px;border-radius:6px;background:rgba(var(--accent-rgb),0.18);border:1px solid rgba(var(--accent-rgb),0.35);color:var(--accent)}
    [data-theme='dark'] .badge{background:rgba(var(--accent-rgb),0.25);color:var(--text);border-color:rgba(255,255,255,0.18)}
    .queue-card{background:rgba(255,255,255,0.4)}
    [data-theme='dark'] .queue-card{background:rgba(14,26,30,0.75)}
    .queue-item{display:flex;flex-direction:column;gap:10px;padding:14px;border:1px dashed rgba(var(--accent-rgb),0.35);border-radius:12px}
    [data-theme='dark'] .queue-item{border-color:rgba(255,255,255,0.18)}
    .queue-top{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .queue-pos{font-weight:600;font-size:12px;color:var(--muted)}
    .queue-flags{display:flex;gap:6px;flex-wrap:wrap}
    .empty-state{text-align:center;font-size:12px;color:var(--muted);padding:12px;border:1px dashed rgba(var(--accent-rgb),0.3);border-radius:10px;background:rgba(255,255,255,0.45)}
    [data-theme='dark'] .empty-state{background:rgba(22,38,40,0.65);border-color:rgba(255,255,255,0.15)}
    .pane-controls button{padding:4px 10px;border-radius:999px;font-size:11px}
    .pane-controls button.is-active{background:rgba(var(--accent-rgb),0.22);border-color:var(--accent);color:var(--accent);box-shadow:0 0 0 1px rgba(var(--accent-rgb),0.35);}
    [data-theme='dark'] .pane-controls button.is-active{background:rgba(var(--accent-rgb),0.28);color:var(--text);}
    .live-check-chip{align-self:flex-start;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.08em;padding:4px 8px;border-radius:999px;background:rgba(255,200,80,0.22);color:#8a6922;border:1px solid rgba(255,200,80,0.35)}
    .composer-actions{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:12px}
    .composer-actions .primary{min-width:160px}
    @media (max-width:1180px){
      .workspace-shell{flex-direction:column}
      .workspace-pane{max-width:none}
      .workspace-gutter{height:8px;width:auto;cursor:row-resize}
      .entry-scroll{max-height:none;padding-right:0}
      .workspace-shell[data-max]{flex-direction:column}
    }
    .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 18px 36px var(--shadow);background-image:var(--grain-pattern);background-blend-mode:overlay}
    .card .hd{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid var(--border)}
    .card .bd{padding:18px}
    .pill{display:inline-flex;align-items:center;gap:6px;background:rgba(var(--accent-rgb),0.18);border:1px solid rgba(var(--accent-rgb),0.35);padding:4px 10px;border-radius:999px;color:var(--accent);font-size:12px;text-transform:uppercase;letter-spacing:.05em}
    [data-theme='dark'] .pill{background:rgba(var(--accent-rgb),0.25);color:var(--text);border-color:rgba(255,255,255,0.25)}
    .row{display:flex;align-items:center;gap:8px}
    .stack{display:flex;flex-direction:column;gap:10px}.textarea{width:100%;min-height:90px}.mini{font-size:12px}
    .entry-card{display:flex;flex-direction:column}
    .entry-card .bd{flex:1;display:flex;flex-direction:column;gap:20px;padding:18px 0 24px;min-height:0}
    @media (min-width:1100px){
      .entry-card .bd{padding-right:16px}
      .entry-scroll{flex:1;max-height:calc(100vh - 320px);overflow-y:auto;padding-right:18px;margin-right:-18px}
      .entry-scroll::-webkit-scrollbar{width:6px}
      .entry-scroll::-webkit-scrollbar-thumb{background:rgba(var(--accent-rgb),0.45);border-radius:999px}
    }
    .entry-scroll{flex:1;display:flex;flex-direction:column;gap:0;min-height:0;padding-right:0;margin-right:0}
    .section-tree{display:flex;flex-direction:column;gap:0}
    .section-tree>.section-node:first-child{border-top:1px solid rgba(0,0,0,0.08)}
    [data-theme='dark'] .section-tree>.section-node:first-child{border-top:1px solid rgba(255,255,255,0.05)}
    .section-node{position:relative;padding:12px 18px;border-bottom:1px solid rgba(0,0,0,0.08);background:rgba(255,255,255,0.55);transition:background .16s ease,box-shadow .16s ease,color .16s ease;color:var(--text);background-image:var(--grain-pattern);background-blend-mode:overlay}
    .section-node::before{content:'';position:absolute;inset:0;pointer-events:none;background-image:var(--grain-pattern);background-size:180px 180px;mix-blend-mode:overlay;opacity:0.26;}
    [data-theme='dark'] .section-node{background:rgba(17,30,34,0.85);border-bottom:1px solid rgba(255,255,255,0.05)}
    .section-node.depth-1{padding-left:18px}
    .section-node.depth-2{padding-left:36px}
.section-node.depth-3{padding-left:54px}
.section-node.depth-4{padding-left:72px}
.section-node.depth-5{padding-left:90px}
.section-node.depth-6{padding-left:108px}
.section-node-anchor{position:relative;box-shadow:0 4px 0 rgba(var(--accent-rgb),0.4);}
.section-node-anchor::after{content:'Insert here';position:absolute;bottom:-18px;left:18px;font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--accent);background:var(--panel);padding:2px 6px;border-radius:6px;border:1px solid rgba(var(--accent-rgb),0.35);}
#entrySections.anchor-top::before{content:'New section will appear at document start';display:block;font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--accent);margin-bottom:8px;padding:2px 6px;border-radius:6px;border:1px solid rgba(var(--accent-rgb),0.35);background:var(--panel);}
.section-node:hover{background:rgba(255,255,255,0.85);box-shadow:inset 2px 0 0 rgba(var(--accent-rgb),0.6)}
[data-theme='dark'] .section-node:hover{background:rgba(22,40,44,0.9)}
.section-node-active{background:rgba(var(--accent-rgb),0.22);box-shadow:inset 3px 0 0 var(--accent)}
.section-node-focused{background:rgba(var(--accent-rgb),0.18);box-shadow:inset 3px 0 0 rgba(var(--accent-rgb),0.85)}
.section-node.root-proposal{border:1px dashed rgba(var(--accent-rgb),0.4);border-radius:14px;padding:16px 18px;margin:12px 0;background:rgba(255,255,255,0.6);}
[data-theme='dark'] .section-node.root-proposal{background:rgba(17,30,34,0.92);border-color:rgba(var(--accent-rgb),0.45);}
.section-node.root-proposal .section-header{margin-bottom:10px;}
.section-node.root-proposal.root-proposal-inline{margin:10px 0 18px;}
.section-node.root-proposal.root-proposal-banner{margin-bottom:18px;}
.root-proposal-list{margin:0;padding-left:18px;display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted);list-style:disc;}
.root-proposal-list li{line-height:1.4;}
.root-proposal-list strong{color:var(--text);}
.root-proposal-actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;}
.root-proposal-actions button{font-size:11px;border-radius:999px;padding:6px 12px;}
.section-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.section-heading{font-size:14.4px;font-weight:600;margin:0;color:var(--text)}
.section-body{margin-top:6px;white-space:pre-wrap;color:rgba(0,0,0,0.75);font-size:13px;line-height:1.52}
[data-theme='dark'] .section-body{color:rgba(244,248,247,0.86)}
.section-actions{display:flex;gap:6px;flex-wrap:wrap;opacity:0;transition:opacity .16s ease}
    .section-node.section-node-active .section-actions,
    .section-node.section-node-focused .section-actions{opacity:1}
.section-edit{background:transparent;border:1px solid rgba(var(--accent-rgb),0.25);color:var(--muted);padding:4px 10px;border-radius:999px;font-size:11px;line-height:1;display:inline-flex;align-items:center;gap:6px;cursor:pointer;transition:color .16s ease,background .16s ease,border-color .16s ease;text-transform:uppercase;letter-spacing:.08em}
.section-edit::before{content:'✏';font-size:11px}
.section-edit span{font-size:11px}
.section-edit:hover{color:var(--accent);background:rgba(var(--accent-rgb),0.18);border-color:rgba(var(--accent-rgb),0.45)}
[data-theme='dark'] .section-edit{border-color:rgba(255,255,255,0.25);color:var(--text)}
[data-theme='dark'] .section-edit:hover{border-color:rgba(255,255,255,0.45)}
.section-add{background:transparent;border:1px solid rgba(var(--accent-rgb),0.25);color:var(--muted);padding:4px 10px;border-radius:999px;font-size:11px;line-height:1;display:inline-flex;align-items:center;gap:6px;cursor:pointer;transition:color .16s ease,background .16s ease,border-color .16s ease;text-transform:uppercase;letter-spacing:.08em}
.section-add::before{content:'＋';font-size:12px}
.section-add span{font-size:11px}
.section-add:hover{color:var(--accent);background:rgba(var(--accent-rgb),0.18);border-color:rgba(var(--accent-rgb),0.45)}
[data-theme='dark'] .section-add{border-color:rgba(255,255,255,0.25);color:var(--text)}
[data-theme='dark'] .section-add:hover{border-color:rgba(255,255,255,0.45)}
.anchor-controls{align-items:center}
.anchor-scope{background:rgba(var(--accent-rgb),0.18);color:var(--accent)}
[data-theme='dark'] .anchor-scope{background:rgba(var(--accent-rgb),0.3);color:var(--text)}
.anchor-controls button{font-size:11px;padding:4px 8px;border-radius:999px}
    .change-card{border:1px solid var(--border);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;background:var(--panel)}
    .diff-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px}
    .diff-block{border-radius:10px;border:1px solid rgba(0,0,0,0.08);overflow:hidden;background:rgba(255,255,255,0.55)}
    [data-theme='dark'] .diff-block{background:rgba(20,35,38,0.9);border-color:rgba(255,255,255,0.08)}
    .diff-block h4{margin:0;padding:8px 12px;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);background:rgba(0,0,0,0.05)}
    [data-theme='dark'] .diff-block h4{background:rgba(255,255,255,0.05)}
    .diff-body{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px;line-height:1.5}
    .diff-line{padding:6px 10px;display:block;white-space:pre-wrap}
    .diff-line.add{background:rgba(var(--accent-rgb),0.25);color:var(--text)}
    .diff-line.del{background:rgba(244,143,143,0.25);color:var(--text)}
    .diff-line.neutral{background:rgba(0,0,0,0.04);color:var(--muted)}
    [data-theme='dark'] .diff-line.neutral{background:rgba(255,255,255,0.06)}
    .diff-line.move{background:rgba(255,211,102,0.25);color:#7f6b29}
    .footer{margin-top:8px;display:flex;justify-content:space-between;align-items:center}
    .vote{display:flex;align-items:center;gap:4px}
    .vote button{padding:6px 8px;border-radius:6px}
    .vote .score{min-width:30px;text-align:center}
    .tag{display:inline-block;padding:2px 6px;border-radius:6px;background:rgba(0,0,0,0.05);color:var(--muted);border:1px solid var(--border);font-size:12px}
    [data-theme='dark'] .tag{background:rgba(255,255,255,0.08);color:var(--text)}
    .section-scope{border-style:dashed;border-color:rgba(var(--accent-rgb),0.5);background:rgba(var(--accent-rgb),0.18);color:var(--accent);font-weight:600}
    [data-theme='dark'] .section-scope{color:var(--text)}
    .list{display:flex;flex-direction:column;gap:10px}
    .label{font-size:12px;color:var(--muted)}
    .user-dot{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:var(--panel);border:1px solid var(--border)}
    .sep{height:1px;background:var(--border);margin:10px 0}
    .history{font-size:12px;color:var(--muted)}
    .status{display:flex;gap:6px;flex-wrap:wrap}
    .help{font-size:12px;color:var(--muted)}
    .composer-tree{display:flex;flex-direction:column;gap:12px}
    .composer-node{display:flex;flex-direction:column;gap:14px;border:1px dashed var(--border);border-radius:12px;padding:16px;background:rgba(255,255,255,0.55)}
    [data-theme='dark'] .composer-node{background:rgba(22,38,40,0.85);border-color:rgba(255,255,255,0.12)}
    .composer-node>h3{margin:0;font-size:15px;font-weight:600;color:var(--accent)}
    [data-theme='dark'] .composer-node>h3{color:var(--accent-strong)}
    .composer-fields{display:flex;flex-direction:column;gap:14px;padding:14px;border-radius:10px;background:rgba(var(--accent-rgb),0.15);border:1px solid rgba(var(--accent-rgb),0.35)}
    [data-theme='dark'] .composer-fields{background:rgba(126,191,189,0.14);border-color:rgba(255,255,255,0.18)}
    .composer-field{display:flex;flex-direction:column;gap:6px}
    .composer-field-heading{padding-bottom:10px;border-bottom:1px dashed rgba(var(--accent-rgb),0.3)}
    .composer-field-body{padding-top:4px}
    .composer-label{font-size:11px;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:var(--muted)}
    .composer-input,.composer-textarea{width:100%;border-radius:8px;padding:10px 12px;background:var(--panel-soft);border:1px solid var(--border);box-shadow:inset 0 1px 0 rgba(255,255,255,0.18)}
    [data-theme='dark'] .composer-input,[data-theme='dark'] .composer-textarea{background:var(--panel);box-shadow:none}
    .composer-input:focus,.composer-textarea:focus{outline:2px solid rgba(var(--accent-rgb),0.45)}
    .composer-textarea{min-height:120px;resize:vertical;line-height:1.5}
    .composer-controls{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px;padding-top:10px;border-top:1px solid rgba(var(--accent-rgb),0.25)}
    [data-theme='dark'] .composer-controls{border-top:1px solid rgba(255,255,255,0.18)}
    .muted-small{font-size:11px;color:var(--muted)}
    .ctx-menu{position:fixed;display:none;min-width:200px;background:var(--bg);border:1px solid var(--border);border-radius:10px;box-shadow:0 12px 30px rgba(0,0,0,.2);padding:6px;z-index:1000}
    .ctx-item{display:flex;align-items:center;gap:8px;padding:8px 10px;border-radius:6px;cursor:pointer}
    .ctx-item:hover{background:rgba(var(--accent-rgb),0.15)}
    .ctx-hr{height:1px;background:var(--border);margin:6px 4px}
  </style>
</head>
<body>
  <header>
    <div class="wrap site-head">
      <div class="brand">
        <a href="/">
          <img class="brand-logo brand-logo-light" src="{% static 'img/logo-light.png' %}" alt="GroupMindHub" />
          <img class="brand-logo brand-logo-dark" src="{% static 'img/logo-dark.png' %}" alt="GroupMindHub" />
        </a>
      </div>
      <div class="head-controls">
        <div class="head-links">
          <a href="/" class="pill">Home</a>
          <a href="/updates/" class="pill">Updates</a>
        </div>
        <button type="button" id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
          <span class="toggle-label" id="themeToggleLabel">Light</span>
        </button>
        <div class="user-panel">
          {% if user.is_authenticated %}
            {% with user.get_full_name|default:user.get_username as display_name %}
            <div class="user-chip">
              <span class="user-avatar">{{ display_name|slice:':1'|upper }}</span>
              <span class="user-meta">
                <span class="user-name">{{ display_name }}</span>
                {% if project_membership %}
                  <span class="user-role">{{ project_membership.get_role_display }}</span>
                {% else %}
                  <span class="user-role">Signed in</span>
                {% endif %}
              </span>
              <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit">Logout</button>
              </form>
            </div>
            {% endwith %}
          {% endif %}
        </div>
      </div>
    </div>
  </header>
  <main class="wrap" style="padding:32px 0 48px;">
    <script type="application/json" id="__entry_json">{{ ENTRY_JSON|safe }}</script>
    {% if user_payload %}{{ user_payload|json_script:"__gmh_user" }}{% endif %}
    <section class="project-banner">
      <div>
        <h1>{{ entry.project.name }}</h1>
        {% if entry.project.description %}
        <p>{{ entry.project.description }}</p>
        {% else %}
        <p class="muted-small">No project description provided yet.</p>
        {% endif %}
      </div>
    </section>
    <div class="workspace-toolbar">
      <div class="pane-title">Workspace</div>
      <div class="controls pane-controls">
        <button class="ghost" type="button" data-pane-max="doc" aria-pressed="false">Max doc</button>
        <button class="ghost" type="button" data-pane-max="candidates" aria-pressed="false">Max candidates</button>
        <button class="ghost" type="button" data-pane-max="editor" aria-pressed="false">Max editor</button>
        <button class="ghost" data-pane-layout-reset>Reset layout</button>
      </div>
    </div>
    <div class="workspace-shell" id="workspaceShell" aria-label="GroupMindHub workspace">
      <div class="workspace-pane" data-pane="doc" data-pane-key="doc">
        <section class="card entry-card">
          <div class="hd">
            <div>
              <div class="pane-title">Active document</div>
              <div class="row" style="margin-top:6px;gap:10px;flex-wrap:wrap;">
                <span class="pill">Version <span id="entryVersion2"></span></span>
                <span class="pill">Votes <span id="entryVotes2"></span></span>
              </div>
            </div>
            <div class="pane-controls">
              <button class="primary" id="btnAddSection" aria-label="Add section">Add section</button>
              <button class="ghost" type="button" data-pane-max="doc" aria-label="Maximize active document" aria-pressed="false">Maximize</button>
            </div>
          </div>
          <div class="bd">
            <div class="entry-scroll" tabindex="0" aria-label="Active document sections">
              <div class="section-tree" id="entrySections">
                {% include '_section_tree.html' with sections=entry_sections_tree %}
              </div>
            </div>
          </div>
        </section>
      </div>
      <div class="workspace-gutter" data-between="doc" tabindex="0" role="separator" aria-orientation="vertical" aria-label="Resize active document and candidate panes"></div>
      <div class="workspace-pane candidate-pane" data-pane="candidates" data-pane-key="candidates">
        <section class="card pool-card">
          <div class="hd">
            <div>
              <div class="pane-title">Candidate pool</div>
              <div class="help" id="changeHelp">Loading changes…</div>
            </div>
            <div class="pane-controls">
              <button class="ghost" type="button" data-pane-max="candidates" aria-label="Maximize candidate pool" aria-pressed="false">Maximize</button>
            </div>
          </div>
          <div class="bd">
            <div class="candidate-list" id="candidatePoolList" role="list"></div>
            <div class="empty-state" id="candidatePoolEmpty" role="note">No candidates yet. Keep current text or add a proposal.</div>
          </div>
        </section>
        <section class="card queue-card">
          <div class="hd">
            <div class="pane-title">Waiting queue</div>
          </div>
          <div class="bd">
            <div class="queue-list" id="waitingQueueList" role="list"></div>
            <div class="empty-state" id="waitingQueueEmpty" role="note">Queue is empty for this section.</div>
          </div>
        </section>
        <section class="card history-card">
          <div class="hd">
            <div class="pane-title">History</div>
          </div>
          <div class="bd">
            <div class="list" id="historyList" role="list"></div>
            <div class="empty-state" id="historyEmpty" role="note">No history for this section yet.</div>
          </div>
        </section>
      </div>
      <div class="workspace-gutter" data-between="editor" tabindex="0" role="separator" aria-orientation="vertical" aria-label="Resize candidate and editor panes"></div>
      <div class="workspace-pane" data-pane="editor" data-pane-key="editor">
        <aside class="card composer-card">
          <div class="hd">
            <div>
              <div class="pane-title">Proposal editor</div>
              <div class="live-check-chip" id="liveChecksChip" aria-live="polite">Live checks: stable</div>
            </div>
            <div class="pane-controls">
              <button class="ghost" type="button" data-pane-max="editor" aria-label="Maximize proposal editor" aria-pressed="false">Maximize</button>
            </div>
          </div>
          <div class="bd">
            <div class="stack" id="composerArea"><div class="help">Select a section in the entry to propose edits, nested subsections, or moves.</div></div>
            <div class="stack" style="margin-top:10px">
              <label class="label" for="changeSummary">1‑line summary</label>
              <input id="changeSummary" placeholder="e.g., Improve wording" />
              <div class="stack" style="gap:6px;min-width:0;">
                <div class="row" style="gap:6px;flex-wrap:wrap;">
                  <span class="label">Section:</span>
                  <span id="sectionScope" class="tag section-scope">No section selected</span>
                </div>
                <div class="row anchor-controls" id="anchorRow" style="gap:6px;flex-wrap:wrap;align-items:center;display:none;">
                  <span class="label">After:</span>
                  <span id="anchorScope" class="tag anchor-scope">Document start</span>
                  <div class="row" style="gap:4px;">
                    <button class="ghost" type="button" data-anchor-shift="up">Move up</button>
                    <button class="ghost" type="button" data-anchor-shift="down">Move down</button>
                  </div>
                </div>
                <div class="row" style="gap:6px;flex-wrap:wrap;align-items:flex-start;">
                  <span class="label">Affects:</span>
                  <div id="affectsTags" class="row" style="flex-wrap:wrap;gap:6px"></div>
                </div>
              </div>
              <div class="composer-actions">
                <div class="row" style="gap:8px;flex-wrap:wrap;">
                  <button class="ghost" id="btnSaveDraft">Save draft</button>
                  <button class="ghost" id="btnClear">Clear</button>
                </div>
                <button class="primary" id="btnPublish" disabled>Submit to queue</button>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>
  
  <!-- Debug bootstrap: safe, minimal logger to verify wiring before main script executes; also provides a functional fallback if main script fails to parse. -->
  <script>
    (function(){
      const themeKey='gmh_theme';
      const root=document.documentElement;
      const toggle=document.getElementById('themeToggle');
      const toggleLabel=document.getElementById('themeToggleLabel');
      const favicon=document.getElementById('siteFavicon');
      const applyTheme=(theme)=>{
        root.setAttribute('data-theme', theme);
        if(favicon){ favicon.href = theme==='dark' ? "{% static 'img/favicon-dark.png' %}" : "{% static 'img/favicon-light.png' %}"; }
        if(toggle){ toggle.setAttribute('aria-label', theme==='dark' ? 'Switch to light mode' : 'Switch to dark mode'); }
        if(toggleLabel){ toggleLabel.textContent = theme==='dark' ? 'Dark' : 'Light'; }
      };
      let storedTheme = localStorage.getItem(themeKey);
      if(!storedTheme){ storedTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
      applyTheme(storedTheme);
      if(toggle){
        toggle.addEventListener('click', ()=>{
          const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          localStorage.setItem(themeKey, next);
          applyTheme(next);
        });
      }

      if (!window.__gmhStartDraft) {
        window.__gmhStartDraft = function(sectionId){
          try { console.log('[GMH] stub __gmhStartDraft invoked with', sectionId); } catch(e) {}
          try {
            var scopeEl = document.getElementById('sectionScope');
            if (scopeEl) {
              scopeEl.textContent = String(sectionId);
              scopeEl.style.color = 'var(--text)';
              scopeEl.style.borderStyle = 'solid';
            }
          } catch(e) { try { console.warn('[GMH] stub failed to set scope', e); } catch(_) {} }
          return false;
        };
      }
    })();
  </script>

  <script src="{% static 'js/entry_detail.js' %}?v=20240918"></script>


  
</body>
</html>
