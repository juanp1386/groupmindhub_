{% load static %}
<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>GroupMindHub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link id="siteFavicon" rel="icon" type="image/png" href="{% static 'img/favicon-light.png' %}" />
    <style>
    :root{
      --palette-1:#dadccf;
      --palette-2:#000000;
      --palette-3:#85c4c0;
      --palette-4:#fdfceb;
      --palette-5:#7ebfbd;
      --accent-rgb:133,196,192;
      --grain-pattern:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.2' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.055'/%3E%3C/svg%3E");

      --bg:var(--palette-4);
      --panel:var(--palette-1);
      --panel-soft:#d6dacc;
      --border:#c3c9bb;
      --text:var(--palette-2);
      --muted:#52625f;
      --accent:var(--palette-3);
      --accent-strong:var(--palette-5);
      --shadow:rgba(0,0,0,0.08);
    }

    [data-theme='dark']{
      --bg:#0f1a1d;
      --panel:#142327;
      --panel-soft:#1f3337;
      --border:#243f44;
      --text:#f4faf9;
      --muted:#9bb5b2;
      --accent:#7ebfbd;
      --accent-strong:#9bd7d4;
      --shadow:rgba(0,0,0,0.45);
      --grain-pattern:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cfilter id='n' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.1' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='0.09'/%3E%3C/svg%3E");
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      padding:0 0 48px;
      background:var(--bg);
      background-image:var(--grain-pattern);
      background-attachment:fixed;
      background-size:180px 180px;
      color:var(--text);
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
      line-height:1.55;
    }
    body::before{
      content:'';
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:var(--grain-pattern);
      background-size:180px 180px;
      mix-blend-mode:overlay;
      opacity:0.32;
      z-index:-1;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{color:var(--accent-strong)}
    header{background:linear-gradient(135deg,rgba(var(--accent-rgb),0.85),rgba(126,191,189,0.8));border-bottom:1px solid var(--border);position:sticky;top:0;z-index:20;backdrop-filter:blur(12px);background-image:var(--grain-pattern);background-blend-mode:overlay}
    [data-theme='dark'] header{background:linear-gradient(135deg,rgba(12,32,34,0.92),rgba(18,49,52,0.92));background-image:var(--grain-pattern);background-blend-mode:overlay;}
    footer{background:rgba(var(--accent-rgb),0.15);border-top:1px solid var(--border);padding:14px 0;margin-top:48px}
    [data-theme='dark'] footer{background:rgba(12,32,34,0.8);}
    .wrap{max-width:1100px;margin:0 auto;padding:0 24px}
    .site-head{display:flex;align-items:center;justify-content:space-between;min-height:68px}
    .brand{display:flex;align-items:center;gap:14px}
    .brand-logo{height:57px;width:auto;display:block}
    .brand-logo-dark{display:none}
    [data-theme='dark'] .brand-logo-light{display:none}
    [data-theme='dark'] .brand-logo-dark{display:block}
    .head-controls{display:flex;align-items:center;gap:18px}
    .head-links{display:flex;align-items:center;gap:10px}
    .theme-toggle{display:inline-flex;align-items:center;gap:10px;background:var(--panel-soft);border:1px solid var(--border);color:var(--text);padding:6px 14px;border-radius:999px;font-size:12px;font-weight:500;letter-spacing:.05em;text-transform:uppercase;cursor:pointer;transition:all .2s ease}
    .theme-toggle:hover{border-color:var(--accent);box-shadow:0 6px 16px rgba(var(--accent-rgb),0.18)}
    .theme-toggle .toggle-track{position:relative;width:40px;height:20px;border-radius:999px;background:rgba(var(--accent-rgb),0.3);flex-shrink:0;transition:background .2s}
    .theme-toggle .toggle-thumb{position:absolute;top:2px;left:2px;width:16px;height:16px;border-radius:50%;background:var(--accent);transition:transform .2s,background .2s}
    .theme-toggle .toggle-label{font-weight:600}
    [data-theme='dark'] .theme-toggle{background:var(--panel-soft);color:var(--text)}
    [data-theme='dark'] .theme-toggle .toggle-track{background:rgba(255,255,255,0.25)}
    [data-theme='dark'] .theme-toggle .toggle-thumb{transform:translateX(18px);background:var(--accent-strong)}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;font-size:11px;background:rgba(var(--accent-rgb),0.18);color:var(--accent);border:1px solid rgba(var(--accent-rgb),0.35)}
    [data-theme='dark'] .pill{background:rgba(var(--accent-rgb),0.25);color:var(--text);border-color:rgba(255,255,255,0.25)}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:20px;margin:20px 0;box-shadow:0 24px 48px var(--shadow);background-image:var(--grain-pattern);background-blend-mode:overlay}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 14px;border-radius:10px;font-size:14px;font-weight:500;color:var(--text);background:var(--panel-soft);border:1px solid var(--border);transition:all .18s ease}
    .btn:hover{color:var(--accent);border-color:var(--accent)}
    input,button,textarea,select{background:var(--panel-soft);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:7px 12px;font-family:inherit;font-size:14px;background-image:var(--grain-pattern);background-blend-mode:overlay}
    input:focus,select:focus,textarea:focus{outline:2px solid rgba(var(--accent-rgb),0.45)}
    button{cursor:pointer;transition:all .18s ease}
    button.primary{background:var(--accent);color:var(--bg);border-color:transparent;font-weight:600}
    button.primary:hover{background:var(--accent-strong)}
    button.ghost{background:transparent;border-color:var(--border);color:var(--muted)}
    button.ghost:hover{border-color:var(--accent);color:var(--accent)}
    table{border-collapse:collapse;width:100%;background:var(--panel);border-radius:12px;overflow:hidden;box-shadow:0 12px 24px rgba(0,0,0,0.06)}
    th,td{border:1px solid var(--border);padding:10px 12px;text-align:left;font-size:14px}
    th{background:var(--panel-soft);text-transform:uppercase;letter-spacing:.05em;color:var(--muted);font-size:12px}
    .muted{color:var(--muted);font-size:12px}
    .status-pill{display:inline-flex;align-items:center;gap:6px;padding:3px 10px;border-radius:999px;font-size:11px;background:rgba(var(--accent-rgb),0.18);color:var(--accent);border:1px solid rgba(var(--accent-rgb),0.35)}
    .user-panel{display:flex;align-items:center;gap:14px}
    .user-chip{display:flex;align-items:center;gap:10px;padding:6px 12px;border-radius:999px;background:rgba(var(--accent-rgb),0.16);border:1px solid rgba(var(--accent-rgb),0.35);}
    .user-avatar{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;background:var(--panel);border:1px solid var(--border);font-weight:600;letter-spacing:.02em;color:var(--accent)}
    .user-meta{display:flex;flex-direction:column;line-height:1.2;min-width:0}
    .user-name{font-size:13px;font-weight:600;color:var(--text)}
    .user-role{font-size:11px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
    .auth-links{display:flex;align-items:center;gap:12px;font-size:12px;color:var(--muted)}
    .auth-links a{color:inherit}
    .logout-form{margin:0}
    .logout-form button{background:transparent;border:none;font-size:12px;color:var(--muted);padding:0 0 0 8px;text-decoration:underline;cursor:pointer}
    .logout-form button:hover{color:var(--accent)}
    .auth-card{max-width:420px;margin:48px auto;padding:32px;border-radius:16px;background:var(--panel);border:1px solid var(--border);box-shadow:0 16px 36px var(--shadow);display:flex;flex-direction:column;gap:18px}
    .auth-card h1{margin:0}
    .auth-form{display:flex;flex-direction:column;gap:16px}
    .auth-form .form-field{display:flex;flex-direction:column;gap:6px}
    .auth-form input{width:100%}
    .form-errors,.field-errors{font-size:12px;color:#c23d3d;background:rgba(194,61,61,0.12);padding:8px 12px;border-radius:8px;border:1px solid rgba(194,61,61,0.4)}
    .mini{font-size:12px}
    main.wrap{padding-top:48px}
    [data-theme='dark'] .status-pill{background:rgba(var(--accent-rgb),0.25);color:var(--text);border-color:rgba(255,255,255,0.25)}
  </style>
</head>
<body>
  <header>
    <div class="wrap site-head">
      <div class="brand">
        <a href="/">
          <img class="brand-logo brand-logo-light" src="{% static 'img/logo-light.png' %}" alt="GroupMindHub" />
          <img class="brand-logo brand-logo-dark" src="{% static 'img/logo-dark.png' %}" alt="GroupMindHub" />
        </a>
      </div>
      <div class="head-controls">
        <div class="head-links">
          <a href="/" class="pill">Home</a>
          <a href="/updates/" class="pill">Updates</a>
        </div>
        <button type="button" id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
          <span class="toggle-label" id="themeToggleLabel">Light</span>
        </button>
        <div class="user-panel">
          {% if user.is_authenticated %}
            {% with user.get_full_name|default:user.get_username as display_name %}
            <div class="user-chip">
              <span class="user-avatar">{{ display_name|slice:':1'|upper }}</span>
              <span class="user-meta">
                <span class="user-name">{{ display_name }}</span>
                {% if project_membership %}
                  <span class="user-role">{{ project_membership.get_role_display }}</span>
                {% else %}
                  <span class="user-role">Signed in</span>
                {% endif %}
              </span>
              <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit">Logout</button>
              </form>
            </div>
            {% endwith %}
          {% else %}
            <div class="auth-links">
              <a href="{% url 'login' %}?next={{ request.path|urlencode }}">Login</a>
              <a href="{% url 'signup' %}?next={{ request.path|urlencode }}">Sign up</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </header>
  <main class="wrap">
    {% block content %}{% endblock %}
  </main>
  <footer>
    <div class="wrap muted">MVP Prototype Â· {{ request.path }}</div>
  </footer>
  {% block extra_js %}{% endblock %}
<script>
  (function(){
    const themeKey='gmh_theme';
    const root=document.documentElement;
    const toggle=document.getElementById('themeToggle');
    const toggleLabel=document.getElementById('themeToggleLabel');
    const favicon=document.getElementById('siteFavicon');
    const applyTheme=(theme)=>{
      root.setAttribute('data-theme', theme);
      if(favicon){
        favicon.href = theme==='dark' ? "{% static 'img/favicon-dark.png' %}" : "{% static 'img/favicon-light.png' %}";
      }
      if(toggle){
        toggle.setAttribute('aria-label', theme==='dark' ? 'Switch to light mode' : 'Switch to dark mode');
      }
      if(toggleLabel){ toggleLabel.textContent = theme==='dark' ? 'Dark' : 'Light'; }
    };
    let storedTheme = localStorage.getItem(themeKey);
    if(!storedTheme){
      storedTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    applyTheme(storedTheme);
    if(toggle){
      toggle.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        localStorage.setItem(themeKey, next);
        applyTheme(next);
      });
    }
  })();
</script>
</body>
</html>
