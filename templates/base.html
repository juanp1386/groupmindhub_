{% load static %}
<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>GroupMindHub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link id="siteFavicon" rel="icon" type="image/png" href="{% static 'img/favicon-light.png' %}" />
  <link rel="stylesheet" href="{% static 'css/global.css' %}" />
</head>
<body>
  <header>
    <div class="wrap site-head">
      <div class="brand">
        <a href="/">
          <img class="brand-logo brand-logo-light" src="{% static 'img/logo-light.png' %}" alt="GroupMindHub" />
          <img class="brand-logo brand-logo-dark" src="{% static 'img/logo-dark.png' %}" alt="GroupMindHub" />
        </a>
      </div>
      <button type="button" class="nav-toggle" id="navToggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="headControls">
        <span class="sr-only">Toggle navigation</span>
        <span class="nav-toggle-icon" aria-hidden="true"></span>
      </button>
      <div class="head-controls" id="headControls" data-expanded="false">
        <div class="head-links">
          <a href="/" class="pill">Home</a>
          <a href="/updates/" class="pill">Updates</a>
        </div>
        <button type="button" id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
          <span class="toggle-track"><span class="toggle-thumb"></span></span>
          <span class="toggle-label" id="themeToggleLabel">Light</span>
        </button>
        <div class="user-panel">
          {% if user.is_authenticated %}
            {% with user.get_full_name|default:user.get_username as display_name %}
            <div class="user-chip">
              <span class="user-avatar">{{ display_name|slice:':1'|upper }}</span>
              <span class="user-meta">
                <span class="user-name">{{ display_name }}</span>
                {% if project_membership %}
                  <span class="user-role">{{ project_membership.get_role_display }}</span>
                {% else %}
                  <span class="user-role">Signed in</span>
                {% endif %}
              </span>
              <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit">Logout</button>
              </form>
            </div>
            {% endwith %}
          {% else %}
            <div class="auth-links">
              <a href="{% url 'login' %}?next={{ request.path|urlencode }}">Login</a>
              <a href="{% url 'signup' %}?next={{ request.path|urlencode }}">Sign up</a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </header>
  <main class="wrap">
    {% block content %}{% endblock %}
  </main>
  <footer>
    <div class="wrap muted">MVP Prototype Â· {{ request.path }}</div>
  </footer>
  {% block extra_js %}{% endblock %}
<script>
  (function(){
    const themeKey='gmh_theme';
    const root=document.documentElement;
    const toggle=document.getElementById('themeToggle');
    const toggleLabel=document.getElementById('themeToggleLabel');
    const favicon=document.getElementById('siteFavicon');
    const navToggle=document.getElementById('navToggle');
    const headControls=document.getElementById('headControls');
    const applyTheme=(theme)=>{
      root.setAttribute('data-theme', theme);
      if(favicon){
        favicon.href = theme==='dark' ? "{% static 'img/favicon-dark.png' %}" : "{% static 'img/favicon-light.png' %}";
      }
      if(toggle){
        toggle.setAttribute('aria-label', theme==='dark' ? 'Switch to light mode' : 'Switch to dark mode');
      }
      if(toggleLabel){ toggleLabel.textContent = theme==='dark' ? 'Dark' : 'Light'; }
    };
    let storedTheme = localStorage.getItem(themeKey);
    if(!storedTheme){
      storedTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    applyTheme(storedTheme);
    if(toggle){
      toggle.addEventListener('click', ()=>{
        const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        localStorage.setItem(themeKey, next);
        applyTheme(next);
      });
    }
    if(navToggle && headControls){
      navToggle.addEventListener('click', () => {
        const expanded = navToggle.getAttribute('aria-expanded') === 'true';
        const next = !expanded;
        navToggle.setAttribute('aria-expanded', next ? 'true' : 'false');
        headControls.dataset.expanded = next ? 'true' : 'false';
      });
    }
  })();
</script>
</body>
</html>
